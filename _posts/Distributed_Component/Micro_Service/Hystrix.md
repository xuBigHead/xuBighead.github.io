# Hystrix 概述

在分布式环境中，许多服务依赖项中的一些不可避免地会失败。Hystrix是一个库，它通过添加延迟容忍和容错逻辑来帮助您控制这些分布式服务之间的交互。Hystrix通过隔离服务之间的访问点，停止它们之间的级联故障，并提供回退选项来实现这一点，所有这些都提高了系统的整体弹性。



- 对通过第三方客户端库访问的依赖项(通常通过网络)的延迟和故障提供保护和控制。
- 停止复杂分布式系统中的级联故障。
- 失败后快速恢复。
- 如果可能的话，回退并优雅地降级。
- 启用接近实时的监视、警报和操作控制。



## **Hystrix的设计原则是什么？**

- 防止任何单一依赖耗尽所有容器(如Tomcat)用户线程。

- 减少负载和快速失败，而不是排队。

- 在可行的情况下提供后备方案以保护用户不受故障的影响。

- 使用隔离技术(如舱壁（bulkhead）、泳道（swimlane）和断路器（circuit breaker）模式)来限制任何一个依赖项的影响。

- 通过接近实时的度量、监视和警报来优化发现时间

- 通过配置更改的低延迟传播和Hystrix在大多数方面的动态属性更改来优化恢复时间，这允许您通过低延迟反馈循环进行实时操作修改。

- 防止在整个依赖客户端执行过程中发生故障，而不仅仅是在网络流量中。

	

## **Hystrix如何实现其目标？**

- 将所有对外部系统(或“依赖”)的调用包装到HystrixCommand或hystrixobservableccommand对象中，这些对象通常在单独的线程中执行(这是command模式的一个例子)。
- 超时调用的时间超过您定义的阈值。这是默认的，但是对于大多数依赖项，您通过“属性”自定义设置这些超时，因此它们略高于每个依赖项的99.5%的性能。
- 为每个依赖项维护一个小线程池(或信号量);如果该依赖项已满，那么针对该依赖项的请求将立即被拒绝，而不是排队等待。
- 度量成功、失败(客户端抛出的异常)、超时和线程拒绝。
- 触发断路器，在一段时间内停止对某一特定服务的所有请求，如果该服务的错误率超过阈值，可以手动或自动停止。
- 在请求失败、被拒绝、超时或短路时执行回退逻辑。
- 以接近实时的方式监控度量和配置更改。



# Hystrix 实现原理

## 实现流程

下图显示了当你通过Hystrix向服务依赖请求时会发生什么：

![img](../../../Image/2022/09/220926-7.jpg)

1. 构造一个`HystrixCommand`或`Hystrixobservableccommand`对象
2. 执行命令
3. 是否缓存了响应?
4. 断路器是否打开?
5. 线程池/队列/信号量是否已满?
6. `HystrixObservableCommand.construct()`或`HystrixCommand.run ()`
7. 计算断路器是否健康
8. 执行Fallback逻辑
9. 返回成功的响应





